language: c
sudo: false
# Setting up caches
cache:
  directories:
    - $HOME/.cabal/packages
    - $HOME/.cabal/store

before_cache:
  - rm -fv $HOME/.cabal/packages/hackage.haskell.org/build-reports.log
  # remove files that are regenerated by 'cabal update'
  - rm -fv $HOME/.cabal/packages/hackage.haskell.org/00-index.*
  - rm -fv $HOME/.cabal/packages/hackage.haskell.org/*.json
  - rm -fv $HOME/.cabal/packages/hackage.haskell.org/01-index.cache
  - rm -fv $HOME/.cabal/packages/hackage.haskell.org/01-index.tar
  - rm -fv $HOME/.cabal/packages/hackage.haskell.org/01-index.tar.idx
  - rm -rfv $HOME/.cabal/packages/head.hackage

fast_finish: true

addons:
  apt:
    packages:
      - libgmp-dev
      - cabal-install-3.0
      - ghc-8.4.4
      - latexmk
      - texlive-latex-extra
    sources: [hvr-ghc]

before_install:
  - export PATH=/opt/ghc/bin:$PATH;
  - ghc --version
  - cabal --version

install:
 - ghc   --version
 - cabal --version
 - travis_retry cabal update;

script:
  - cabal build
  - cabal exec driver
  - cd artefact/latex
  - latexmk -pdf  all.tex -interaction=nonstopmode

after_success:
  - echo "All is well."
after_failure:
  - echo "Build failed."

branches:
  only:
    - master
